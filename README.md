# Sturdy 
Sturdy is a DeFi lending protocol. Sturdy enables 'suppliers' to earn yield on their stablecoins and 'borrowers' to take out interest-free stablecoin loans against their collateral. This interest-free mechanic is made possible through rehypothecation: when a borrower deposits their collateral (e.g. ETH), it is staked (e.g. turned into stETH via Lido). Over time, this stETH will grow in quantity over time because of its rebasing mechanic; we harvest this yield, convert it to stablecoins, and distribute it to stablecoin suppliers.

We currently support Dai and USDC for lending and borrowing. Users can provide ETH as collateral, which is then staked via Lido. When users withdraw their collateral, it is swapped from stETH to ETH via Curve. Users also have the option of providing or withdrawing stETH as collateral, skipping the conversion step.

## Audit 
The following three contracts are in the scope of the audit: LendingPool.sol, LidoVault.sol, GeneralVault.sol. 

LendingPool was originally an Aave contract that we edited. The final Aave commit is bc1a237f340dbaf713dedf413c3108bc28b6b8ec. This contract has all the typical functions of a lending protocol such as deposit, withdraw, repay, and borrow. The edits were largely to ensure compatibility with the vaults.

The vaults are used as a bridge between the user and LendingPool. When users want to provide collateral, they deposit their funds the vault. The vault then stakes their collateral and deposits it to LendingPool. When users want to withdraw collateral, the process happens in reverse: funds are transferred from LendingPool to the vault, the vault unstakes or swaps their collateral back to the original token (e.g. stETH -> ETH), and then transfers it to the user. Another function of the vaults is that they harvest and distribute the yield generated by collateral. For example, due to stETH's rebasing mechanic its balance will increase as time passes. This exess stETH will be swapped to ETH via Curve and then Dai or USDC via Uniswap. The Dai or USDC will be deposited into LendingPool and distributed to users who supplied these tokens.

LidoVault (which takes ETH or stETH from the user) is currently the only vault; GeneralVault is a template that all vaults will inherit. 

## Dev Environment
- EnvironmentFile (.env)
```
ALCHEMY_KEY="xxx"
```

- Compile
```
npm run compile
```

- Run the hardhat node on localhost.
```
FORK=main yarn hardhat node
```

- Compile
```
FORK=main yarn hardhat compile
```

- Next run the following task to deploy all smart contracts
```
yarn sturdy:evm:fork:mainnet:migration
```

- For test, run the following task to have a test of sample contract on the localhost.
```
yarn test
```

- To get test tokens in your local forked wallet, open the console by running below command, and run [this script](./impersonating-account.js) in console.
```
FORK=main yarn hardhat console --network forked_main
```